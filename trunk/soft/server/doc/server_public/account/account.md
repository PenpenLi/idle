## 账号服文档

登录方式 邮箱/手机（暂时留着字段）

### 账号服连接

ip（oss中读取）+端口（规定为10001）+消息（服务端定义）

### 数据库设计

| 字段     | 解释                      | 注释                                                         |
| -------- | :------------------------ | :----------------------------------------------------------- |
| pid      | 索引 以及序号             | 默认分配                                                     |
| mail     | 邮箱                      | 客户端传过来的 严格判断格式 不可为空                         |
| password | 密码                      | 客户端传过来的 长度为8-16个字符 不能使用中文 空格 不能含有非法字符(最后一条再议 没想好) |
| phone    | 手机号（不知道 暂时为空） | 再说 不知道 不晓得                                           |

---

### 返回错误信息

| 字段 | 解释                                              |
| ---- | :------------------------------------------------ |
| 0    | 成功                                              |
| 1    | 注册成功（与登录成功等做区别 仅用于注册相关判定） |
| -1   | 邮箱已注册/用户已存在                             |
| -2   | 未注册用户                                        |
| -3   | 邮箱格式错误                                      |
| -4   | 密码错误                                          |
| -5   | 邮件发送错误                                      |
| -6   | 长度错误                                          |
| -7   | 未知错误                                          |

---

### 客户端消息

| 消息      | 字段                                                    | 解析                                                         |
| --------- | :------------------------------------------------------ | ------------------------------------------------------------ |
| /reg      |                                                         | 注册用户                                                     |
|           | mail                                                    | 严格控制mail格式 双端都检查                                  |
|           | phone                                                   | 暂时无视 可为空                                              |
|           | password                                                | 密码 控制长度                                                |
| 返回值    | 0, {"token": token}                                     | token 唯一标识                                               |
| /login    |                                                         | 登录账号服                                                   |
|           | mail                                                    | 邮箱 非本地缓存严格检查格式                                  |
|           | password                                                | 密码                                                         |
| 返回值    | 0, {"token": token}                                     | token 唯一标识                                               |
| /chpwd    |                                                         | 修改密码                                                     |
|           | mail                                                    | 邮箱 用户在游戏中的唯一标识                                  |
|           | old_password                                            | 旧密码                                                       |
|           | password                                                | 新密码                                                       |
| 返回值    | 0                                                       | 成功                                                         |
| /recovery |                                                         | 找回密码                                                     |
|           | mail                                                    | 用于接收邮件                                                 |
|           | lang                                                    | 语言 0中文/1英文                                             |
| 返回值    | 0                                                       | 邮件发送成功 请登录邮箱查看结果                              |
| /check    |                                                         | 登录验证                                                     |
|           | token                                                   | 唯一标识 用户登录账号服获得                                  |
|           | password                                                | 密码                                                         |
| 返回值    | 0                                                       | 登录成功                                                     |
| /tourist  |                                                         | 游客登录                                                     |
|           | tour                                                    | 内容为空 仅仅用作验证                                        |
| 返回值    | 1, {'mail': mail, 'password': password, 'token': token} | 邮箱（账号服随机生成的18位字母） 密码（客户端随机生成的15位字母） token 唯一标识 |
| /bind     |                                                         | 游客绑定                                                     |
|           | mail                                                    | 邮箱 严格校验格式                                            |
|           | password                                                | 密码 校验格式                                                |
|           | old_mail                                                | 账号服生成的游客邮箱数据 18位随机字母组成                    |
|           | old_password                                            | 账号服生成的游客密码 15位随机字母                            |
| 返回值    | 0/1, {"token": token}                                   | 0绑定成功/1old_mail为空 按照注册流程处理 注册成功 token 唯一标识 |



2019.08.05